<source>
    @type tail
    format ltsv
    path /var/log/nginx/access.log
    pos_file /tmp/access.log.pos
    tag nginx.access
    <parse>
        @type nginx
    </parse>
</source>

<source>
    @type tail
    format ltsv
    path /var/log/nginx/error.log
    pos_file /tmp/error.log.pos
    tag nginx.error
    <parse>
        @type nginx
    </parse>
</source>

## Ex: local dev setting
# <match nginx.access>
#   @type file
# #   format single_value
#   path /fluentd/log/access.%Y%m%d-%H%M
#   time_slice_format %Y-%m-%d
#   <buffer time>
#     @type file
#     path /fluentd/log/buf_access
#     flush_interval 60s
#     timekey 60
#     timekey_wait 0
#     timekey_zone Asia/Tokyo
#   </buffer>
# </match>

# <match docker.**>
# @type copy
# <store>
#     @type file
#     @id   output_docker1
#     path         /fluentd/log/docker.*.log
#     symlink_path /fluentd/log/docker.log
#     append       true
#     time_slice_format %Y%m%d
#     time_slice_wait   1m
#     time_format       %Y%m%dT%H%M%S%z
# </store>
# </match>

<match nginx.access>
    @type s3
    format single_value
    s3_bucket dev-onpa-bucket
    s3_region ap-northeast-1
    <format>
      @type ltsv
    </format>
    path "logs/web/nginx/access/%Y/%m/%d/%H/#{Socket.gethostname}"
    <buffer tag,time>
        @type file
        path /fluentd/log/buf_access
        timekey 1m
        timekey_wait 0
        timekey_zone Asia/Tokyo
    </buffer>
</match>

<match nginx.error>
    @type s3
    format single_value
    s3_bucket dev-onpa-bucket
    s3_region ap-northeast-1
    <format>
      @type ltsv
    </format>    
    path "logs/web/nginx/error/%Y/%m/%d/%H/#{Socket.gethostname}"
    <buffer tag,time>
        @type file
        path /fluentd/log/buf_error
        timekey 1m
        timekey_wait 0
        timekey_zone Asia/Tokyo
    </buffer>
</match>
